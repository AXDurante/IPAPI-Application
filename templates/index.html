<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <title>Public IP Information</title>
    <script>
      let userLatitude, userLongitude;

      // Function to fetch geolocation based on user's IP
      function fetchGeolocation() {
        fetch("https://ipapi.co/json/")
          .then((response) => response.json())
          .then((data) => {
            userLatitude = data.latitude;
            userLongitude = data.longitude;

            // Display the geolocation data
            document.getElementById("geo-info").innerHTML = `
                <div class="row">
                    <div class="col-6">
                        <h3>Your Geolocation:</h3>
                        <p>IP Address: ${data.ip}</p>
                        <p>IP Version: ${data.version}</p>
                        <p>City: ${data.city}</p>
                        <p>Region: ${data.region}</p>
                        <p>Country: ${data.country_name}</p>
                        <p>Country Code: ${data.country_code}</p>
                        <p>Latitude: ${data.latitude}</p>
                       
                 
                    </div>
                    <div class="col-6">
                        <br>  <br>
                         <p>Longitude: ${data.longitude}</p>
                            <p>ASN: ${data.asn}</p>
                        <p>Organization:${data.org}</p>
                    </div>
                </div>
            `;

            // Initialize the map
            initMap(userLatitude, userLongitude);
          })
          .catch((error) => {
            console.error("Error fetching geolocation:", error);
          });
      }

      // Function to initialize Google Maps
      function initMap(lat, lng) {
        const location = { lat: lat, lng: lng };
        const map = new google.maps.Map(document.getElementById("map"), {
          zoom: 10,
          center: location,
        });
        const marker = new google.maps.Marker({
          position: location,
          map: map,
        });
      }

      // Display initial message
      window.onload = function () {
        document.getElementById("geo-info").innerHTML = `
          <h3>Press the button to see your IP location info.</h3>
        `;
      };
    </script>
    <script
      async
      defer
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCuPU_getGfrCAygsxdigj8Iv9rtFu1aYU"
    ></script>
  </head>
  <body>
    <div class="container p-5">
      <h1 class="text-center my-4">Public IP Information</h1>

      <!-- Button to Get IP Information -->
      <form
        action="/get_ip_info"
        method="POST"
        onsubmit="fetchGeolocation(); return false;"
      >
        <button type="submit" class="btn btn-primary my-4">
          Get IP Information
        </button>
      </form>

      <!-- Geolocation Information -->

      <!-- Google Map -->
      <div class="row">
        <div class="col-8">
          <!-- Error Handling -->
          {% if error %}
          <div class="alert alert-danger">{{ error }}</div>
          {% endif %} {% if ip_info %}
          <div id="geo-info" class="alert alert-info"></div>
          {% endif %}
        </div>
        <div class="col-4">
          <div id="map" style="height: 400px; width: 100%"></div>
        </div>
      </div>
    </div>
  </body>
</html>
